<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Profile - Krishi Mitr</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>

<style>

/* ===== BODY ===== */
body {
  margin: 0;
  font-family: "Poppins", Arial, sans-serif;
  min-height: 100vh;
  background: linear-gradient(180deg,#f6e2cc 0%,#f7f9f8 45%,#dceee3 100%);
  color: #1f2937;
}
body.drawer-open { overflow: hidden; }

/* ===== NAVBAR ===== */
.top-nav {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 78px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 32px;
  background: linear-gradient(90deg,#ff9933,#ffffff,#138808);
  border-bottom: 3px solid #0a3d62;
  box-shadow: 0 6px 14px rgba(0,0,0,0.15);
  z-index: 9999;
}

.nav-left {
  display: flex;
  align-items: center;
  gap: 14px;
}

.hamburger-btn {
  width: 44px;
  height: 44px;
  border-radius: 12px;
  border: 2px solid #0a3d62;
  background: rgba(255,255,255,0.75);
  display: grid;
  place-items: center;
  cursor: pointer;
}

.hamburger-icon {
  width: 20px;
  height: 14px;
  position: relative;
}
.hamburger-icon span {
  position: absolute;
  left: 0;
  right: 0;
  height: 2.5px;
  background: #0a3d62;
  border-radius: 999px;
}
.hamburger-icon span:nth-child(1){ top:0; }
.hamburger-icon span:nth-child(2){ top:5.5px; }
.hamburger-icon span:nth-child(3){ top:11px; }

.brand-title {
  margin: 0;
  font-size: 1.15rem;
  font-weight: 800;
  color: #0a3d62;
}

.logout-btn {
  background: white;
  color: #0a3d62;
  border: 2px solid #0a3d62;
  padding: 10px 18px;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
}

/* ===== PROFILE CARD ===== */
.container {
  margin-top: 170px;
  display: flex;
  justify-content: center;
}

.profile-card {
  background: rgba(255,255,255,0.95);
  padding: 50px 60px;
  border-radius: 25px;
  box-shadow: 0 20px 45px rgba(0,0,0,0.15);
  width: 420px;
  transition: transform 0.3s ease;
}
.profile-card:hover {
  transform: translateY(-5px);
}

.profile-card h2 {
  margin-top: 0;
  text-align: center;
  color: #0a3d62;
}

.field {
  margin-bottom: 20px;
}

.field label {
  font-weight: 600;
}

.field input {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: 2px solid #0a3d62;
}

.password-wrapper {
  position: relative;
}

.eye-btn {
  position: absolute;
  right: 10px;
  top: 35px;
  cursor: pointer;
  font-size: 18px;
}

.update-btn {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: none;
  font-weight: 700;
  background: linear-gradient(135deg,#138808,#2ecc71);
  color: white;
  cursor: pointer;
  transition: 0.3s;
}
.update-btn:hover {
  transform: scale(1.03);
}

/* ===== GREEN SUCCESS POPUP ===== */
.success-popup {
  position: fixed;
  top: 100px;
  right: 30px;
  background: linear-gradient(135deg,#2ecc71,#27ae60);
  color: white;
  padding: 16px 22px;
  border-radius: 12px;
  font-weight: 600;
  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  opacity: 0;
  transform: translateY(-20px);
  transition: all 0.4s ease;
  z-index: 99999;
}
.success-popup.show {
  opacity: 1;
  transform: translateY(0);
}

</style>
</head>

<body>

<div class="top-nav">
  <div class="nav-left">
    <button class="hamburger-btn">
      <div class="hamburger-icon">
        <span></span><span></span><span></span>
      </div>
    </button>
    <p class="brand-title">Krishi Mitr</p>
  </div>
  <button class="logout-btn" id="logoutBtn">Logout</button>
</div>

<div class="container">
  <div class="profile-card">
    <h2>Your Profile</h2>

    <div class="field">
      <label>Username</label>
      <input type="text" id="username" disabled>
    </div>

    <div class="field">
      <label>Name</label>
      <input type="text" id="name" disabled>
    </div>

    <div class="field password-wrapper">
      <label>Password</label>
      <input type="password" id="password" disabled>
      <span class="eye-btn" onclick="togglePassword()">üëÅ</span>
    </div>

    <button class="update-btn" id="editBtn">Update Profile</button>
  </div>
</div>

<div class="success-popup" id="successPopup">
  ‚úî Profile Updated Successfully
</div>

<script>
const db = window.db;
const loginid = sessionStorage.getItem("loginid");

async function loadProfile(){
  const { data, error } = await db
    .from("logindata")
    .select("username,name,password")
    .eq("loginid", loginid)
    .single();

  if(error || !data){
    console.error("Profile load error:", error);
    return;
  }

  document.getElementById("username").value = data.username || "";
  document.getElementById("name").value = data.name || "";
  document.getElementById("password").value = data.password || "";
}

function togglePassword(){
  const pass = document.getElementById("password");
  pass.type = pass.type === "password" ? "text" : "password";
}

let editing=false;

document.getElementById("editBtn").onclick = async function(){

  const username = document.getElementById("username");
  const nameField = document.getElementById("name");
  const password = document.getElementById("password");

  if(!editing){
    username.disabled=false;
    nameField.disabled=false;
    password.disabled=false;
    this.innerText="Save Changes";
    editing=true;
  }else{

    const { error } = await db
      .from("logindata")
      .update({
        username: username.value,
        name: nameField.value,
        password: password.value
      })
      .eq("loginid", loginid);

    if(error){
      alert("Error updating profile");
      return;
    }

    username.disabled=true;
    nameField.disabled=true;
    password.disabled=true;
    this.innerText="Update Profile";
    editing=false;

    showSuccessPopup();
  }
};

function showSuccessPopup(){
  const popup = document.getElementById("successPopup");
  popup.classList.add("show");

  setTimeout(()=>{
    popup.classList.remove("show");
  },3000);
}

document.getElementById("logoutBtn").onclick=()=>{
  sessionStorage.clear();
  location.href="login";
};

loadProfile();
</script>

</body>
</html>

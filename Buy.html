<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Buy Crops - Krishi Mitr</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>

<style>
/* ===== SAME BODY STYLE ===== */
body {
  margin: 0;
  font-family: "Poppins", Arial, sans-serif;
  min-height: 100vh;
  background: linear-gradient(180deg,#f6e2cc 0%,#f7f9f8 45%,#dceee3 100%);
  color: #1f2937;
}
body.drawer-open { overflow: hidden; }

/* ===== NAVBAR ===== */
.top-nav {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 78px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 32px;
  background: linear-gradient(90deg,#ff9933,#ffffff,#138808);
  border-bottom: 3px solid #0a3d62;
  box-shadow: 0 6px 14px rgba(0,0,0,0.15);
  z-index: 9999;
}

.nav-left { display:flex; align-items:center; gap:14px; }
.brand-title { font-weight:800; color:#0a3d62; }

.logout-btn {
  background:white;
  color:#0a3d62;
  border:2px solid #0a3d62;
  padding:10px 18px;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
}
.logout-btn:hover {
  background:#0a3d62;
  color:white;
}

/* ===== CONTENT ===== */
.container {
  max-width: 900px;
  margin: 150px auto 60px;
}

.sell-card {
  background: white;
  border-radius: 26px;
  padding: 8px;
  box-shadow: 0 18px 40px rgba(0,0,0,0.18);
}

.sell-inner {
  background: white;
  border-radius: 20px;
  padding: 50px;
  border-top: 6px solid #ff9933;
  border-bottom: 6px solid #138808;
}

label { font-weight:600; margin-top:14px; display:block; }

input {
  width:100%;
  padding:12px;
  border-radius:12px;
  border:2px solid #0a3d62;
  font-size:1em;
}
input:focus { outline:none; border-color:#ff9933; }

.submit-btn {
  margin-top:30px;
  width:100%;
  padding:16px;
  border:none;
  border-radius:14px;
  font-size:1.1em;
  font-weight:700;
  background:linear-gradient(135deg,#138808,#2ecc71);
  color:white;
  cursor:pointer;
}

/* ===== POPUP ===== */
.popup-overlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.5);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:99999;
}

.popup {
  background:white;
  padding:30px;
  border-radius:20px;
  width:400px;
  max-width:90%;
  text-align:center;
  box-shadow:0 15px 35px rgba(0,0,0,0.3);
}

.popup h3 { margin-top:0; }

.popup button {
  margin-top:20px;
  padding:10px 20px;
  border:none;
  border-radius:10px;
  background:#138808;
  color:white;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="top-nav">
  <div class="nav-left">
    <p class="brand-title">Krishi Mitr</p>
  </div>
  <button class="logout-btn" onclick="logout()">Logout</button>
</div>

<div class="container">
  <div class="sell-card">
    <div class="sell-inner">
      <h1>Buy Crop</h1>

      <label>Crop Name</label>
      <input type="text" id="cropName" readonly>

      <label>Available Quantity (kg)</label>
      <input type="number" id="totalQuantity" readonly>

      <label>Minimum Order (kg)</label>
      <input type="number" id="minQuantity" readonly>

      <label>Price per kg (₹)</label>
      <input type="number" id="price" readonly>

      <label>Enter Quantity to Buy</label>
      <input type="number" id="buyQuantity">

      <button class="submit-btn" onclick="buyCrop()">Buy Now</button>
    </div>
  </div>
</div>

<!-- POPUP -->
<div class="popup-overlay" id="popupOverlay">
  <div class="popup">
    <h3 id="popupTitle"></h3>
    <div id="popupMessage"></div>
    <button onclick="closePopup()">OK</button>
  </div>
</div>

<script>
function showPopup(title,message){
  document.getElementById("popupTitle").innerText=title;
  document.getElementById("popupMessage").innerHTML=message;
  document.getElementById("popupOverlay").style.display="flex";
}
function closePopup(){
  document.getElementById("popupOverlay").style.display="none";
}

function buyCrop(){
  const total = parseInt(totalQuantity.value);
  const min = parseInt(minQuantity.value);
  const priceVal = parseInt(price.value);
  const buyQty = parseInt(buyQuantity.value);

  if(buyQty < min){
    showPopup("Invalid Quantity","Please enter more than minimum quantity.");
    return;
  }

  if(buyQty > total){
    showPopup("Invalid Quantity","Please enter less than available quantity.");
    return;
  }

  const totalPrice = buyQty * priceVal;

  showPopup("Purchase Details",
    `<b>Crop:</b> ${cropName.value}<br><br>
     <b>Quantity:</b> ${buyQty} kg<br><br>
     <b>Price per kg:</b> ₹${priceVal}<br><br>
     <b>Total Price:</b> ₹${totalPrice}`
  );
}

function logout(){
  sessionStorage.clear();
  location.href="login";
}
</script>

</body>
</html>

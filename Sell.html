<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sell Crops - Krishi Mitr</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>

<style>
body{
  margin:0;
  font-family:Poppins,Arial,sans-serif;
  min-height:100vh;
  background:linear-gradient(180deg,#f6e2cc,#f7f9f8,#dceee3);
}

/* NAVBAR */
.top-nav{
  position:fixed;
  top:0; left:0; right:0;
  height:78px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 30px;
  background:linear-gradient(90deg,#ff9933,#ffffff,#138808);
  border-bottom:3px solid #0a3d62;
  z-index:100;
}

.nav-left{
  display:flex;
  gap:15px;
}

.nav-box{
  background:#0a3d62;
  color:#fff;
  padding:10px 18px;
  border-radius:10px;
  text-decoration:none;
  font-weight:600;
}

.logout-btn{
  background:white;
  border:2px solid #0a3d62;
  padding:10px 22px;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
}

/* CONTENT */
.container{
  max-width:950px;
  margin:140px auto 60px;
}

.card{
  background:white;
  border-radius:22px;
  padding:40px;
  box-shadow:0 18px 35px rgba(0,0,0,.18);
  border-top:6px solid #ff9933;
  border-bottom:6px solid #138808;
}

h1{
  text-align:center;
  color:#0a3d62;
  margin-bottom:30px;
}

.form-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:22px;
}

.full{
  grid-column:1 / -1;
}

label{
  font-weight:600;
  display:block;
  margin-bottom:6px;
}

input,select,textarea{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid #cbd5e1;
  font-size:15px;
}

textarea{
  resize:none;
  height:90px;
}

.submit-btn{
  margin-top:30px;
  width:100%;
  padding:16px;
  font-size:18px;
  font-weight:700;
  background:#0a3d62;
  color:white;
  border:none;
  border-radius:14px;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- NAVBAR -->
<div class="top-nav">
  <div class="nav-left">
    <a class="nav-box" href="Dashboard">Dashboard</a>
    <a class="nav-box" href="Sell">Sell Crops</a>
    <a class="nav-box" href="Update_crops">Manage Crops</a>
  </div>
  <button class="logout-btn" id="logoutBtn">Logout</button>
</div>

<div class="container">
  <div class="card">
    <h1>Sell Your Crops</h1>

    <form id="sellForm">
      <div class="form-grid">

        <div>
          <label>Farmer Name</label>
          <input type="text" id="farmerName" readonly>
        </div>

        <div>
          <label>Contact Info</label>
          <input type="text" id="contactInfo" required>
        </div>

        <div>
          <label>Crop Name</label>
          <input type="text" id="cropName" required>
        </div>

        <div>
          <label>Crop Category</label>
          <select id="cropCategory" required>
            <option value="">Select</option>
            <option>Grain</option>
            <option>Vegetable</option>
            <option>Fruit</option>
            <option>Pulse</option>
            <option>Spice</option>
            <option>Other</option>
          </select>
        </div>

        <div>
          <label>Total Quantity (kg)</label>
          <input type="number" id="quantity" required>
        </div>

        <div>
          <label>Minimum Order Quantity (kg)</label>
          <input type="number" id="minQuantity" required>
        </div>

        <div>
          <label>Price (â‚¹ / kg)</label>
          <input type="text" id="price" required>
        </div>

        <div>
          <label>Quality</label>
          <select id="quality" required>
            <option value="">Select</option>
            <option>Premium</option>
            <option>Standard</option>
            <option>Low</option>
          </select>
        </div>

        <div>
          <label>Harvest Date</label>
          <input type="date" id="harvestDate" required>
        </div>

        <div>
          <label>Available Until</label>
          <input type="date" id="availableUntil" required>
        </div>

        <div>
          <label>Delivery Type</label>
          <select id="deliveryType" required>
            <option value="">Select</option>
            <option>Self Pickup</option>
            <option>Farmer Delivery</option>
            <option>Transport Available</option>
          </select>
        </div>

        <div>
          <label>Location / Address</label>
          <input type="text" id="location" required>
        </div>

        <div class="full">
          <label>Description (Optional)</label>
          <textarea id="description"></textarea>
        </div>

      </div>

      <button class="submit-btn">Submit Crop</button>
    </form>
  </div>
</div>

<script>
const db = window.db;

async function loadFarmer(){
  const loginid = sessionStorage.getItem("loginid");
  if(!loginid){
    location.href="login";
    return;
  }

  const {data} = await db
    .from("logindata")
    .select("name")
    .eq("loginid",loginid)
    .single();

  document.getElementById("farmerName").value = data.name;
}

document.getElementById("sellForm").addEventListener("submit",async(e)=>{
  e.preventDefault();

  const loginid = sessionStorage.getItem("loginid");

  const {error} = await db.from("crop_sales").insert({
    farmer_name: farmerName.value,
    crop_name: cropName.value,
    crop_category: cropCategory.value,
    quantity: quantity.value,
    min_quantity: minQuantity.value,
    price: price.value,
    quality: quality.value,
    harvest_date: harvestDate.value,
    available_until: availableUntil.value,
    delivery_type: deliveryType.value,
    location: location.value,
    contact_info: contactInfo.value,
    description: description.value,
    jid: crypto.randomUUID(),
    lid: loginid
  });

  if(error){
    alert(error.message);
  }else{
    alert("Crop listed successfully");
    e.target.reset();
    loadFarmer();
  }
});

document.getElementById("logoutBtn").onclick=()=>{
  sessionStorage.clear();
  location.href="login";
};

loadFarmer();
</script>

</body>
</html>

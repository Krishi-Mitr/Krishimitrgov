<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Rent Tools - Krishi Mitr</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>

<style>
body {
  margin: 0;
  font-family: "Poppins", Arial, sans-serif;
  min-height: 100vh;
  background: linear-gradient(180deg,#f6e2cc 0%,#f7f9f8 45%,#dceee3 100%);
  color: #1f2937;
}
body.drawer-open { overflow: hidden; }

.top-nav {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 78px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 32px;
  background: linear-gradient(90deg,#ff9933,#ffffff,#138808);
  border-bottom: 3px solid #0a3d62;
  box-shadow: 0 6px 14px rgba(0,0,0,0.15);
  z-index: 9999;
}
.nav-left {
  display: flex;
  align-items: center;
  gap: 14px;
}
.hamburger-btn {
  width: 44px;
  height: 44px;
  border-radius: 12px;
  border: 2px solid #0a3d62;
  background: rgba(255,255,255,0.75);
  display: grid;
  place-items: center;
  cursor: pointer;
}
.hamburger-icon {
  width: 20px;
  height: 14px;
  position: relative;
}
.hamburger-icon span {
  position: absolute;
  left: 0;
  right: 0;
  height: 2.5px;
  background: #0a3d62;
  border-radius: 999px;
}
.hamburger-icon span:nth-child(1) { top:0; }
.hamburger-icon span:nth-child(2) { top:5.5px; }
.hamburger-icon span:nth-child(3) { top:11px; }

.brand-title {
  font-weight: 800;
  color: #0a3d62;
}

.nav-right {
  display: flex;
  align-items: center;
  gap: 15px;
}
.profile-btn img {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  border: 2px solid #0a3d62;
  cursor: pointer;
  transition: 0.3s;
}
.profile-btn img:hover {
  transform: scale(1.1);
  box-shadow: 0 0 15px rgba(10,61,98,0.4);
}
.logout-btn {
  background: white;
  color: #0a3d62;
  border: 2px solid #0a3d62;
  padding: 10px 18px;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
  transition: 0.3s;
}
.logout-btn:hover {
  background: #0a3d62;
  color: white;
}

.nav-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.25);
  opacity: 0;
  pointer-events: none;
  transition: opacity .2s ease;
  z-index: 9998;
}
.side-drawer {
  position: fixed;
  top: 84px;
  left: 14px;
  width: min(320px, calc(100vw - 28px));
  max-height: calc(100vh - 98px);
  overflow: auto;
  background: linear-gradient(180deg,#0a3d62,#082032);
  border: 3px solid #ffffff;
  border-radius: 18px;
  box-shadow: 0 18px 40px rgba(0,0,0,0.35);
  transform: translateX(-110%);
  transition: transform .25s ease;
  z-index: 9999;
}
.drawer-inner { padding: 14px; }

body.drawer-open .nav-overlay {
  opacity: 1;
  pointer-events: auto;
}
body.drawer-open .side-drawer {
  transform: translateX(0);
}

.menu-section {
  border-radius: 14px;
  overflow: hidden;
  border: 1px solid rgba(255,255,255,0.15);
  margin-bottom: 14px;
  background: rgba(255,255,255,0.05);
}
.menu-section-title {
  padding: 12px 14px;
  background: rgba(255,255,255,0.1);
  color: white;
  font-weight: 800;
  font-size: 0.95rem;
}
.menu-list { list-style: none; padding: 0; margin: 0; }
.menu-list a {
  display: block;
  padding: 14px;
  text-decoration: none;
  color: white;
  font-weight: 600;
  background: rgba(255,255,255,0.08);
  transition: 0.2s ease;
}
.menu-list li + li a { border-top: 1px solid rgba(255,255,255,0.1); }
.menu-list a:hover { background: #1e3a8a; padding-left: 20px; }

.container {
  max-width: 900px;
  margin: 150px auto 60px;
}
.rental-card {
  background: white;
  border-radius: 26px;
  padding: 8px;
  box-shadow: 0 18px 40px rgba(0,0,0,0.18);
}
.rental-inner {
  background: white;
  border-radius: 20px;
  padding: 50px;
  border-top: 6px solid #138808;
  border-bottom: 6px solid #ff9933;
}
.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}
.full-width { grid-column: span 2; }

label { font-weight: 600; margin-top: 14px; display: block; color: #0a3d62; }
input, textarea, select {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: 2px solid #cbd5e1;
  font-size: 1em;
  box-sizing: border-box;
}
textarea { resize: vertical; }
input:focus, textarea:focus, select:focus { outline: none; border-color: #138808; box-shadow: 0 0 0 4px rgba(19, 136, 8, 0.1); }
.input-error { border: 2px solid #dc2626 !important; background: #fff5f5; }

.submit-btn {
  margin-top: 30px;
  width: 100%;
  padding: 18px;
  border: none;
  border-radius: 14px;
  font-size: 1.2em;
  font-weight: 800;
  background: linear-gradient(135deg,#0a3d62,#1e3a8a);
  color: white;
  cursor: pointer;
  transition: transform 0.2s;
}
.submit-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(10, 61, 98, 0.2); }

@media (max-width: 600px) {
  .form-grid { grid-template-columns: 1fr; }
  .full-width { grid-column: span 1; }
  .rental-inner { padding: 30px 20px; }
}
</style>
</head>
<body>

<div class="top-nav">
  <div class="nav-left">
    <button class="hamburger-btn" id="menuBtn">
      <div class="hamburger-icon"><span></span><span></span><span></span></div>
    </button>
    <p class="brand-title">Krishi Mitr | Tools</p>
  </div>
  <div class="nav-right">
    <div class="profile-btn" onclick="location.href='Profile'">
      <img src="profile_pic.png" alt="Profile">
    </div>
    <button class="logout-btn" id="logoutBtn">Logout</button>
  </div>
</div>

<div class="nav-overlay" id="navOverlay" hidden></div>
<nav class="side-drawer" id="sideNav" hidden>
  <div class="drawer-inner">
    <div class="menu-section">
      <div class="menu-section-title">Main</div>
      <ul class="menu-list">
        <li><a href="Dashboard">Dashboard</a></li>
      </ul>
    </div>
    <div class="menu-section">
      <div class="menu-section-title">Rental Hub</div>
      <ul class="menu-list">
        <li><a href="Browse_Tools">Browse Available Tools</a></li>
        <li><a href="My_Listings">My Tool Listings</a></li>
      </ul>
    </div>
    <div class="menu-section">
      <div class="menu-section-title">Market</div>
      <ul class="menu-list">
        <li><a href="Sell">Sell Your Crops</a></li>
        <li><a href="Buy">Buy Your Crop</a></li>
      </ul>
    </div>
    <div class="menu-section" style="margin-bottom:0;">
      <div class="menu-section-title">System</div>
      <ul class="menu-list">
        <li><a href="Notification">Notification</a></li>
        <li><a href="Chat">Chat</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container">
  <div class="rental-card">
    <div class="rental-inner">
      <h1 style="margin-top: 0; color: #0a3d62;">List a Tool for Rent</h1>
      <p style="margin-bottom: 30px; color: #64748b;">Earn extra income by renting out your equipment to fellow farmers.</p>
      
      <form id="rentalForm">
        <div class="form-grid">
          <div class="full-width">
            <label>Tool/Equipment Name</label>
            <input type="text" id="toolName" placeholder="Example: John Deere Tractor, Power Tiller">
          </div>

          <div>
            <label>Category</label>
            <select id="toolCategory">
              <option value="">Select Category</option>
              <option value="Tractors">Tractors</option>
              <option value="Harvesting">Harvesting Equipment</option>
              <option value="Seeding">Seeding Machinery</option>
              <option value="Irrigation">Irrigation Tools</option>
              <option value="HandTools">Hand Tools</option>
            </select>
          </div>

          <div>
            <label>Condition</label>
            <select id="toolCondition">
              <option value="Excellent">Excellent (Like New)</option>
              <option value="Good">Good (Working Well)</option>
              <option value="Fair">Fair (Functional)</option>
            </select>
          </div>

          <div>
            <label>Rental Price (₹ / Day)</label>
            <input type="number" id="pricePerDay" placeholder="Example: 1500">
          </div>

          <div>
            <label>Security Deposit (₹)</label>
            <input type="number" id="securityDeposit" placeholder="Refundable amount">
          </div>

          <div>
            <label>Available From</label>
            <input type="date" id="availFrom">
          </div>

          <div>
            <label>Available To</label>
            <input type="date" id="availTo">
          </div>

          <div class="full-width">
            <label>Pickup Location</label>
            <input type="text" id="toolLocation" placeholder="Full address or village name">
          </div>

          <div>
            <label>Contact Number</label>
            <input type="tel" id="contactInfo" placeholder="10-digit mobile number">
          </div>

          <div>
            <label>Owner Name</label>
            <input type="text" id="ownerName" readonly>
          </div>

          <div class="full-width">
            <label>Description & Technical Specs</label>
            <textarea id="description" rows="4" placeholder="Mention HP, fuel type, or any usage restrictions..."></textarea>
          </div>
        </div>

        <button type="submit" class="submit-btn">List Equipment Now</button>
      </form>
    </div>
  </div>
</div>

<script>
const db = window.db;
const loginid = sessionStorage.getItem("loginid");
const usertype = sessionStorage.getItem("usertype");

if(!loginid || usertype !== "Farmer"){ location.href="login"; }

async function loadProfile(){
  const { data } = await db.from("logindata").select("name").eq("loginid", loginid).maybeSingle();
  ownerName.value = data?.name || "";
}

document.getElementById("rentalForm").addEventListener("submit", async e=>{
  e.preventDefault();
  let valid = true;

  const inputs = [
    toolName, toolCategory, toolCondition, 
    pricePerDay, securityDeposit, availFrom, 
    availTo, toolLocation, contactInfo
  ];

  inputs.forEach(input => {
    input.classList.remove("input-error");
    if(!input.value.trim()){
      input.classList.add("input-error");
      valid = false;
    }
  });

  if(!/^\d{10}$/.test(contactInfo.value)){
    contactInfo.classList.add("input-error");
    valid = false;
  }

  if(!valid){
    alert("Please fill all fields correctly.");
    return;
  }

  const { error } = await db.from("tool_rentals").insert({
    owner_name: ownerName.value,
    tool_name: toolName.value,
    category: toolCategory.value,
    condition: toolCondition.value,
    price_per_day: pricePerDay.value,
    security_deposit: securityDeposit.value,
    available_from: availFrom.value,
    available_to: availTo.value,
    location: toolLocation.value,
    contact: contactInfo.value,
    description: description.value,
    tool_id: crypto.randomUUID(),
    user_id: loginid
  });

  if(error){
    alert(error.message);
  } else {
    alert("Equipment listed for rent successfully!");
    e.target.reset();
    loadProfile();
  }
});

document.getElementById("logoutBtn").onclick = ()=>{ 
  sessionStorage.clear(); 
  location.href="login"; 
};

const menuBtn = document.getElementById("menuBtn");
const sideNav = document.getElementById("sideNav");
const navOverlay = document.getElementById("navOverlay");

function openDrawer(){ 
  document.body.classList.add("drawer-open"); 
  sideNav.hidden=false; 
  navOverlay.hidden=false; 
}

function closeDrawer(){ 
  document.body.classList.remove("drawer-open"); 
  setTimeout(()=>{ 
    if(!document.body.classList.contains("drawer-open")){ 
      sideNav.hidden=true; 
      navOverlay.hidden=true; 
    }
  },220); 
}

menuBtn.onclick = ()=>{ 
  document.body.classList.contains("drawer-open") ? closeDrawer() : openDrawer(); 
};

navOverlay.onclick = closeDrawer;

loadProfile();
</script>

</body>
</html>

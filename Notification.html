async function loadNotifications() {
  const container = document.getElementById("notificationList");
  container.innerHTML = "<h3>Loading requests...</h3>";

  const { data: toolRequests, error: toolError } = await db
    .from("notifications")
    .select("*")
    .eq("receiver_id", String(loginid))
    .order("created_at", { ascending: false });

  if (toolError) {
    console.error("Fetch Error:", toolError);
    return;
  }

  const { data: crops } = await db.from("crop_sales").select("jid").eq("lid", loginid);
  let cropRequests = [];
  if (crops && crops.length > 0) {
    const cropIds = crops.map(c => c.jid);
    const { data } = await db.from("buy_table").select("*").in("fid", cropIds);
    cropRequests = data || [];
  }

  container.innerHTML = "";

  if (toolRequests.length === 0 && cropRequests.length === 0) {
    container.innerHTML = "<h3>No notifications found.</h3>";
    return;
  }

  toolRequests.forEach(item => {
    const card = document.createElement("div");
    card.className = "notification-card tool-request";
    
    let actionHtml = "";
    if (item.status === 'pending') {
      actionHtml = `
        <div class="actions">
          <button class="btn-accept" onclick="updateToolStatus(${item.id}, 'Accepted', ${item.tool_id})">Accept</button>
          <button class="btn-decline" onclick="updateToolStatus(${item.id}, 'Declined')">Decline</button>
        </div>`;
    } else {
      actionHtml = `<div class="status ${item.status === 'Accepted' ? 'accepted' : 'declined'}">${item.status}</div>`;
    }

    card.innerHTML = `
      <span class="type-tag tool-tag">Tool Rental</span>
      <strong>${item.sender_name}</strong> wants to rent <strong>${item.tool_name}</strong>
      <div class="detail-row">Days: ${item.requested_days} | Total: â‚¹${item.total_price}</div>
      ${actionHtml}
    `;
    container.appendChild(card);
  });
}
